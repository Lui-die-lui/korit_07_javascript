<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <link rel="stylesheet" href="./_shoppinglist.css">
  </head>
  <body>
    <div class="todo-Container">
      <h1>My Shopping List</h1>
      <div class="input-group">
        <input
          type="text"
          id="item-input"
          placeholder="구매할 물품을 입력하세요."
        />
        <input type="number" id="price-input" placeholder="가격" min="0" />
        <button id="add-btn">추가</button>
      </div>
      <ul id="shopping-list" class="shopping-list">
        <!-- 쇼핑 리스트 아이템이 추가될 부분 -->
      </ul>
    </div>
    <script>
      // DOM element 가져오기
      const itemInput = document.getElementById("item-input");
      const priceInput = document.getElementById("price-input");
      const addBtn = document.getElementById("add-btn");
      const shoppingList = document.getElementById("shopping-list");

      const shoppingItems =
        JSON.parse(localStorage.getItem("shopping-items")) || []; // 아니면 빈배열

      function renderShoppingList() {
        shoppingList.innerHTML = ""; // 요소

        // 자바스크립트 배열
        shoppingItems.forEach((item, index) => {
          const li = document.createElement("li");
          li.className = "todo-items";
          if (item.completed) {
            li.classList.add("completed");
          }
          const checkbox = document.createElement("input");
          checkbox.type = "checkbox";
          checkbox.checked = item.completed;

          const itemTextSpan = document.createElement("span");
          itemTextSpan.className = "item-text";
          itemTextSpan.textContent = item.text;

          const priceSpan = document.createElement("span");
          priceSpan.className = "price";

          // 가격을 모르면 입력 안할 수 있게 해두려고 함. - 삼항 연산자
          priceSpan.textContent = item.price ? `${item.price} 원` : "";

          const deleteBtn = document.createElement("button");
          deleteBtn.className = "delete-btn";
          deleteBtn.innerHTML = "&times";

          li.append(checkbox);
          li.append(itemTextSpan);
          li.append(priceSpan);
          li.append(deleteBtn);

          shoppingList.appendChild(li);

          checkbox.addEventListener("change", () => {
            shoppingItems[index].completed = checkbox.checked;
            li.classList.toggle("completed", checkbox.checked);
            saveShoppingItems();
          });

          deleteBtn.addEventListener("click", () => {
            shoppingItems.splice(index, 1);
            saveShoppingItems();
            renderShoppingList(); // 삭제 버튼을 눌렀을 때 renderShoppingList내에서 다시 renderShoppingList를 호출하게끔 작성 -> 재귀용법
          });
        });
      }

      function saveShoppingItems() {
        localStorage.setItem("shopping-items", JSON.stringify(shoppingItems));
      }

      function addShoppingItem() {
        const itemText = itemInput.value.trim();
        const itemPrice = priceInput.value.trim();

        if (itemText === "") {
          alert("구매할 물품을 입력해주세요.");
          return;
        }
        // -----------------------------------------------------------------

        const newShoppingItem = {
          text: itemText,
          price: itemPrice,
          completed: false,
        };

        shoppingItems.push(newShoppingItem);

        itemInput.value = "";
        priceInput.value = "";

        renderShoppingList(); // 다시 띄우고
        saveShoppingItems(); // 저장함
      }

      // 소괄호 쓰지 않는 이유
      // 소괄호 유무에 따른 함수의 실행 방식 차이
      addBtn.addEventListener("click", addShoppingItem); 

      /*
       Scanner scanner = new Scanner(System.in);
       sout("이름을 입력하세요 >>>")
       String name = scanner.nextLine(); -> 메서드의 결과값이 리턴됨

       함수명(); -> return 값 자체가 전달됨. 그래서 위 작성한 코드에 ()쓰지 않음.
      */

      itemInput.addEventListener("keydown", (e) => {
        if (e.key === "Enter") {
          addShoppingItem();
        }
      });

      priceInput.addEventListener("keydown", (e) => {
        if (e.key === "Enter") {
          addShoppingItem();
        }
      });

      window.onload = renderShoppingList();
    </script>
  </body>
</html>
